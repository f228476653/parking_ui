<div class="mat-container">
    <div class="row">
        <div class="col col-md-2">
            <mat-form-field class="stationbox">
                <mat-select [(ngModel)]="query.garage_group_id" placeholder="場站群組" (selectionChange)=getGarageGroup($event)>
                    <mat-option value="all">全部</mat-option>
                    <mat-option [value]="groupname" *ngFor="let groupname of groupname">
                        {{ groupname }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="stationbox">
                <mat-select [(ngModel)]="query.garage_code" placeholder="場站">
                    <mat-option [value]="garage.garage_code" *ngFor="let garage of garageList.data">
                        {{ garage.garage_name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="col col-md-10">
            <mat-accordion>
                <mat-expansion-panel [expanded]="isKeepExpended === 1">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            搜尋
                        </mat-panel-title>
                        <mat-panel-description>
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <div class="row">
                        <div class="col col-md-12">
                    <label>交易日期: </label>&nbsp;&nbsp;
                    <mat-form-field class="datebox">
                        <input matInput [(ngModel)]="paid_date_begin.date" [matDatepicker]="picker1" placeholder="起始日期">
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                        <span matPrefix></span>
                    </mat-form-field>

                    <mat-form-field class="timebox">
                        <input matInput [(ngModel)]="paid_date_begin.hour" [ngClass]="{'validation-error':has_error_paid_begin_hour,'validation-normal':!has_error_paid_begin_hour}" (change)="check_time_format('hour','paid_date_begin_hour')" type="number" min="00" max="23" placeholder="時">
                        <span matPrefix></span>
                    </mat-form-field>

                    <mat-form-field class="timebox">
                        <input matInput [(ngModel)]="paid_date_begin.min" [ngClass]="{'validation-error':has_error_paid_begin_min,'validation-normal':!has_error_paid_begin_min}" (change)="check_time_format('min','paid_date_begin_min')" type="number" min="00" max="59" placeholder="分">
                        <span matPrefix></span>
                    </mat-form-field>

                    <mat-form-field class="datebox">
                        <input matInput [(ngModel)]="paid_date_end.date" [matDatepicker]="picker3" placeholder="結束日期">
                        <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                        <mat-datepicker #picker3></mat-datepicker>
                        <span matPrefix></span>
                    </mat-form-field>

                    <mat-form-field class="timebox">
                        <input matInput [(ngModel)]="paid_date_end.hour" [ngClass]="{'validation-error':has_error_paid_end_hour,'validation-normal':!has_error_paid_end_hour}" (change)="check_time_format('hour','paid_date_end_hour')" type="number" min="0" max="23" placeholder="時">
                        <span matPrefix></span>
                    </mat-form-field>

                    <mat-form-field class="timebox">
                        <input matInput [(ngModel)]="paid_date_end.min" [ngClass]="{'validation-error':has_error_paid_end_min,'validation-normal':!has_error_paid_end_min}" (change)="check_time_format('min','paid_date_end_min')" type="number" min="0" max="59" placeholder="分">
                        <span matPrefix></span>
                    </mat-form-field>
                </div>
            </div>
            </mat-expansion-panel>
    
        <mat-expansion-panel >
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        進階搜尋
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <div class="row">
                    <div class="col col-md-12">
                        <label>進場時間: </label>&nbsp;&nbsp;
                        <mat-form-field class="datebox">
                            <input matInput [(ngModel)]="enter_date_begin.date" [matDatepicker]="picker2" placeholder="起始日期">
                            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                            <mat-datepicker #picker2></mat-datepicker>
                            <span matPrefix></span>
                        </mat-form-field>

                        <mat-form-field class="timebox">
                            <input matInput [(ngModel)]="enter_date_begin.hour" [ngClass]="{'validation-error':has_error_enter_begin_hour,'validation-normal':!has_error_enter_begin_hour}" (change)="check_time_format('hour','enter_date_begin_hour')" type="number" min="0" max="23"
                                placeholder="時">
                            <span matPrefix></span>
                        </mat-form-field>

                        <mat-form-field class="timebox">
                            <input matInput [(ngModel)]="enter_date_begin.min" [ngClass]="{'validation-error':has_error_enter_begin_min,'validation-normal':!has_error_enter_begin_min}" (change)="check_time_format('min','enter_date_begin_min')" type="number" min="0" max="59" placeholder="分">
                            <span matPrefix></span>
                        </mat-form-field>

                        <mat-form-field class="datebox">
                            <input matInput [(ngModel)]="enter_date_end.date" [matDatepicker]="picker4" placeholder="結束日期">
                            <mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
                            <mat-datepicker #picker4></mat-datepicker>
                            <span matPrefix></span>
                        </mat-form-field>

                        <mat-form-field class="timebox">
                            <input matInput [(ngModel)]="enter_date_end.hour" [ngClass]="{'validation-error':has_error_enter_end_hour,'validation-normal':!has_error_enter_end_hour}" (change)="check_time_format('hour','enter_date_end_hour')" type="number" min="0" max="23" placeholder="時">
                            <span matPrefix></span>
                        </mat-form-field>

                        <mat-form-field class="timebox">
                            <input matInput [(ngModel)]="enter_date_end.min" [ngClass]="{'validation-error':has_error_enter_end_min,'validation-normal':!has_error_enter_end_min}" (change)="check_time_format('min','enter_date_end_min')" type="number" min="0" max="59" placeholder="分">
                            <span matPrefix></span>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col col-md-12">
                        <mat-form-field class="pvbox2">
                            <mat-select [(ngModel)]="query.vehicle_type" placeholder="車種">
                                <mat-option value="c">汽車</mat-option>
                                <mat-option value="m">機車</mat-option>
                            </mat-select>
                        </mat-form-field>
        
                        <mat-form-field class="invoicebox2">
                            <mat-select [(ngModel)]="query.paid_type" placeholder="交易票種">
                                <mat-option value="03">一卡通</mat-option>
                                <mat-option value="01">悠遊卡</mat-option>
                            </mat-select>
                        </mat-form-field>
            
                        <!-- <mat-form-field class="invoicebox2">
                            <mat-select [(ngModel)]="query.transfer_discount" placeholder="轉乘優惠">
                                <mat-option value="true">有</mat-option>
                                <mat-option value="false">無</mat-option>
                            </mat-select>
                        </mat-form-field> -->
            
                        <mat-form-field class="pricebox">
                            <input matInput [(ngModel)]="query.real_fee" placeholder="實付費用" min="0" class="example-right-align">
                            <span matPrefix>NTD&nbsp;</span>
                        </mat-form-field>
            
                        <mat-form-field class="invoicebox">
                            <input matInput [(ngModel)]="query.card_id16" placeholder="卡片內碼">
                        </mat-form-field>
            
                        <mat-form-field class="invoicebox">
                            <input matInput [(ngModel)]="query.invoice_number" placeholder="發票號碼">
                        </mat-form-field>
            
                        <mat-form-field class="invoicebox">
                            <mat-select [(ngModel)]="query.invoice_check" placeholder="發票開立狀態">
                                <mat-option value="0">全部</mat-option>
                                <mat-option value="1">已開出</mat-option>
                            </mat-select>
                        </mat-form-field>
            
                        <!-- <mat-form-field class="invoicebox2">
                            <mat-select [(ngModel)]="query.special_charge" placeholder="身障計費">
                                <mat-option value="true">有</mat-option>
                                <mat-option value="false">無</mat-option>
                            </mat-select>
                        </mat-form-field> -->
                    </div>
                </div>
            </mat-expansion-panel>
        </mat-accordion>
        </div>
    </div>
    <div class="row" style="margin-top:5px;">
            <div class="col col-md-8"></div>
            <div class="col col-md-4">
                <div class="button-row">
                    <button mat-raised-button color="primary" (click)="onSearch()">搜尋</button>
                    <button mat-raised-button color="warn" (click)="clearTableFilter()">清除搜尋條件</button>
                </div>
            </div>
    </div>
    </div>
<div>
    <mat-table #table [dataSource]="dataSource" matSort>

        <ng-container matColumnDef="random_num">
            <mat-header-cell *matHeaderCellDef> 流水號 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.no}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="garage_name">
            <mat-header-cell *matHeaderCellDef> 場站名稱 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.garage_name}} </mat-cell>
        </ng-container>


        <ng-container matColumnDef="card_type">
            <mat-header-cell *matHeaderCellDef> 交易票種 </mat-header-cell>
            <mat-cell *matCellDef="let element">
                <span [ngSwitch]="element.paid_type">
                    <span *ngSwitchCase="'03'">一卡通</span>
                <span *ngSwitchCase="'01'">悠遊卡</span>
                </span>
            </mat-cell>
        </ng-container>

        <ng-container matColumnDef="card_num">
            <mat-header-cell *matHeaderCellDef> 卡號 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.card_id}} [{{element.card_id16}}] </mat-cell>
        </ng-container>

        <!-- <ng-container matColumnDef="car_type" >
            <mat-header-cell *matHeaderCellDef> 車種 </mat-header-cell>
            <container-element [ngSwitch]="type">
                <ng-container  *ngSwitchCase="m">
                    <mat-cell *matCellDef="let element"> 機車 </mat-cell>
                </ng-container>
                <ng-container  *ngSwitchCase="c">
                    <mat-cell *matCellDef="let element"> 汽車 </mat-cell>
                </ng-container>
            </container-element>
        </ng-container> -->

        <ng-container matColumnDef="car_type">
            <mat-header-cell *matHeaderCellDef> 車種 </mat-header-cell>
            <mat-cell *matCellDef="let element">
                <span [ngSwitch]="element.type">
                    <span *ngSwitchCase="'c'">汽車</span>
                <span *ngSwitchCase="'m'">機車</span>
                </span>
            </mat-cell>
        </ng-container>

        <ng-container matColumnDef="entry_pv">
            <mat-header-cell *matHeaderCellDef> 進場PV </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.pv}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="exit_pv">
            <mat-header-cell *matHeaderCellDef> 出場PV </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.pv_out}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="entry_time">
            <mat-header-cell *matHeaderCellDef> 進場時間 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.enter_time}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="exit_time">
            <mat-header-cell *matHeaderCellDef> 出場時間 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.exit_time}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="paid_time">
            <mat-header-cell *matHeaderCellDef> 付費時間 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.paid_time}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="parking_time">
            <mat-header-cell *matHeaderCellDef> 經過時間 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.timediff}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="paid_money">
            <mat-header-cell *matHeaderCellDef> 實付費用 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.real_fee}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="invoice_num">
            <mat-header-cell *matHeaderCellDef> 電子發票號碼 </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.invoice_number}} </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <mat-paginator #paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]">
    </mat-paginator>

</div>