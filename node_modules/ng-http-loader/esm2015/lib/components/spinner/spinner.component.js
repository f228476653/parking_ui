import { Component, Input } from '@angular/core';
import { merge, timer } from 'rxjs';
import { debounce } from 'rxjs/operators';
import { PendingInterceptorService } from '../../services/pending-interceptor.service';
import { SpinnerVisibilityService } from '../../services/spinner-visibility.service';
import { Spinkit } from '../../spinkits';
export class SpinnerComponent {
    constructor(pendingInterceptorService, spinnerVisibilityService) {
        this.pendingInterceptorService = pendingInterceptorService;
        this.spinnerVisibilityService = spinnerVisibilityService;
        this.Spinkit = Spinkit;
        this.spinner = Spinkit.skCubeGrid;
        this.filteredUrlPatterns = [];
        this.debounceDelay = 0;
        this.entryComponent = null;
        this.subscriptions = merge(this.pendingInterceptorService.pendingRequestsStatus.pipe(debounce(this.handleDebounce.bind(this))), this.spinnerVisibilityService.visibilityObservable)
            .subscribe(this.handleSpinnerVisibility().bind(this));
    }
    ngOnInit() {
        this.nullifySpinnerIfComponentOutletIsDefined();
        if (!(this.filteredUrlPatterns instanceof Array)) {
            throw new TypeError('`filteredUrlPatterns` must be an array.');
        }
        if (!!this.filteredUrlPatterns.length) {
            this.filteredUrlPatterns.forEach(e => {
                this.pendingInterceptorService.filteredUrlPatterns.push(new RegExp(e));
            });
        }
    }
    ngOnDestroy() {
        this.subscriptions.unsubscribe();
    }
    nullifySpinnerIfComponentOutletIsDefined() {
        if (null != this.entryComponent) {
            this.spinner = null;
        }
    }
    handleSpinnerVisibility() {
        return v => this.isSpinnerVisible = v;
    }
    handleDebounce(hasPendingRequests) {
        if (hasPendingRequests) {
            return timer(this.debounceDelay);
        }
        return timer(0);
    }
}
SpinnerComponent.decorators = [
    { type: Component, args: [{
                selector: 'spinner',
                template: `<div id="spinner" *ngIf="isSpinnerVisible">

    <ng-container *ngComponentOutlet="entryComponent"></ng-container>

    <sk-cube-grid
        *ngIf="spinner === Spinkit.skCubeGrid"
        [backgroundColor]="backgroundColor">
    </sk-cube-grid>

    <sk-chasing-dots
        *ngIf="spinner === Spinkit.skChasingDots"
        [backgroundColor]="backgroundColor">
    </sk-chasing-dots>

    <sk-double-bounce
        *ngIf="spinner === Spinkit.skDoubleBounce"
        [backgroundColor]="backgroundColor">
    </sk-double-bounce>

    <sk-rotating-plane
        *ngIf="spinner === Spinkit.skRotatingPlane"
        [backgroundColor]="backgroundColor">
    </sk-rotating-plane>

    <sk-spinner-pulse
        *ngIf="spinner === Spinkit.skSpinnerPulse"
        [backgroundColor]="backgroundColor">
    </sk-spinner-pulse>

    <sk-three-bounce
        *ngIf="spinner === Spinkit.skThreeBounce"
        [backgroundColor]="backgroundColor">
    </sk-three-bounce>

    <sk-wandering-cubes
        *ngIf="spinner === Spinkit.skWanderingCubes"
        [backgroundColor]="backgroundColor">
    </sk-wandering-cubes>

    <sk-wave
        *ngIf="spinner === Spinkit.skWave"
        [backgroundColor]="backgroundColor">
    </sk-wave>

</div>

`,
                styles: [`#spinner{top:0;left:0;height:100%;width:100%;position:fixed;z-index:9999;opacity:.7;background-color:#f1f1f1;display:flex;align-items:center;justify-content:center}::ng-deep .colored-parent,::ng-deep .colored>div{background-color:#333}`]
            },] },
];
SpinnerComponent.ctorParameters = () => [
    { type: PendingInterceptorService, },
    { type: SpinnerVisibilityService, },
];
SpinnerComponent.propDecorators = {
    "backgroundColor": [{ type: Input },],
    "spinner": [{ type: Input },],
    "filteredUrlPatterns": [{ type: Input },],
    "debounceDelay": [{ type: Input },],
    "entryComponent": [{ type: Input },],
};
function SpinnerComponent_tsickle_Closure_declarations() {
    SpinnerComponent.decorators;
    SpinnerComponent.ctorParameters;
    SpinnerComponent.propDecorators;
    SpinnerComponent.prototype.isSpinnerVisible;
    SpinnerComponent.prototype.subscriptions;
    SpinnerComponent.prototype.Spinkit;
    SpinnerComponent.prototype.backgroundColor;
    SpinnerComponent.prototype.spinner;
    SpinnerComponent.prototype.filteredUrlPatterns;
    SpinnerComponent.prototype.debounceDelay;
    SpinnerComponent.prototype.entryComponent;
    SpinnerComponent.prototype.pendingInterceptorService;
    SpinnerComponent.prototype.spinnerVisibilityService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bpbm5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1odHRwLWxvYWRlci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3NwaW5uZXIvc3Bpbm5lci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBU0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxLQUFLLEVBQTRCLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDdkYsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFDckYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBcUR6QyxNQUFNO0lBZ0JGLFlBQW9CLHlCQUFvRCxFQUFVLHdCQUFrRDtRQUFoSCw4QkFBeUIsR0FBekIseUJBQXlCLENBQTJCO1FBQVUsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjt1QkFabkgsT0FBTzt1QkFJUCxPQUFPLENBQUMsVUFBVTttQ0FFSSxFQUFFOzZCQUVsQixDQUFDOzhCQUVLLElBQUk7UUFHN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQ3RCLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFDbkcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLG9CQUFvQixDQUNyRDthQUNJLFNBQVMsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztLQUM3RDtJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsd0NBQXdDLEVBQUUsQ0FBQztRQUVoRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLElBQUksU0FBUyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7U0FDbEU7UUFFRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDakMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzFFLENBQUMsQ0FBQztTQUNOO0tBQ0o7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztLQUNwQztJQUVPLHdDQUF3QztRQUM1QyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7U0FDdkI7O0lBR0csdUJBQXVCO1FBQzNCLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7O0lBR2xDLGNBQWMsQ0FBQyxrQkFBMkI7UUFDOUMsRUFBRSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3BDO1FBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzs7OztZQTVHdkIsU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxTQUFTO2dCQUNuQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0E4Q2I7Z0JBQ0csTUFBTSxFQUFFLENBQUMsNk9BQTZPLENBQUM7YUFDMVA7OztZQXREUSx5QkFBeUI7WUFDekIsd0JBQXdCOzs7Z0NBMkQ1QixLQUFLO3dCQUVMLEtBQUs7b0NBRUwsS0FBSzs4QkFFTCxLQUFLOytCQUVMLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1NcbiAqIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUlxuICogQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSXG4gKiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTlxuICogQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgbWVyZ2UsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiwgdGltZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUGVuZGluZ0ludGVyY2VwdG9yU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BlbmRpbmctaW50ZXJjZXB0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBTcGlubmVyVmlzaWJpbGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGlubmVyLXZpc2liaWxpdHkuc2VydmljZSc7XG5pbXBvcnQgeyBTcGlua2l0IH0gZnJvbSAnLi4vLi4vc3BpbmtpdHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3NwaW5uZXInLFxuICAgIHRlbXBsYXRlOiBgPGRpdiBpZD1cInNwaW5uZXJcIiAqbmdJZj1cImlzU3Bpbm5lclZpc2libGVcIj5cblxuICAgIDxuZy1jb250YWluZXIgKm5nQ29tcG9uZW50T3V0bGV0PVwiZW50cnlDb21wb25lbnRcIj48L25nLWNvbnRhaW5lcj5cblxuICAgIDxzay1jdWJlLWdyaWRcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBTcGlua2l0LnNrQ3ViZUdyaWRcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2stY3ViZS1ncmlkPlxuXG4gICAgPHNrLWNoYXNpbmctZG90c1xuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IFNwaW5raXQuc2tDaGFzaW5nRG90c1wiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay1jaGFzaW5nLWRvdHM+XG5cbiAgICA8c2stZG91YmxlLWJvdW5jZVxuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IFNwaW5raXQuc2tEb3VibGVCb3VuY2VcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2stZG91YmxlLWJvdW5jZT5cblxuICAgIDxzay1yb3RhdGluZy1wbGFuZVxuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IFNwaW5raXQuc2tSb3RhdGluZ1BsYW5lXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXJvdGF0aW5nLXBsYW5lPlxuXG4gICAgPHNrLXNwaW5uZXItcHVsc2VcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBTcGlua2l0LnNrU3Bpbm5lclB1bHNlXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXNwaW5uZXItcHVsc2U+XG5cbiAgICA8c2stdGhyZWUtYm91bmNlXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gU3BpbmtpdC5za1RocmVlQm91bmNlXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXRocmVlLWJvdW5jZT5cblxuICAgIDxzay13YW5kZXJpbmctY3ViZXNcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBTcGlua2l0LnNrV2FuZGVyaW5nQ3ViZXNcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2std2FuZGVyaW5nLWN1YmVzPlxuXG4gICAgPHNrLXdhdmVcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBTcGlua2l0LnNrV2F2ZVwiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay13YXZlPlxuXG48L2Rpdj5cblxuYCxcbiAgICBzdHlsZXM6IFtgI3NwaW5uZXJ7dG9wOjA7bGVmdDowO2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7cG9zaXRpb246Zml4ZWQ7ei1pbmRleDo5OTk5O29wYWNpdHk6Ljc7YmFja2dyb3VuZC1jb2xvcjojZjFmMWYxO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn06Om5nLWRlZXAgLmNvbG9yZWQtcGFyZW50LDo6bmctZGVlcCAuY29sb3JlZD5kaXZ7YmFja2dyb3VuZC1jb2xvcjojMzMzfWBdXG59KVxuZXhwb3J0IGNsYXNzIFNwaW5uZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG4gICAgcHVibGljIGlzU3Bpbm5lclZpc2libGU6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb247XG5cbiAgICBwdWJsaWMgU3BpbmtpdCA9IFNwaW5raXQ7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgYmFja2dyb3VuZENvbG9yOiBzdHJpbmc7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgc3Bpbm5lciA9IFNwaW5raXQuc2tDdWJlR3JpZDtcbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBmaWx0ZXJlZFVybFBhdHRlcm5zOiBzdHJpbmdbXSA9IFtdO1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGRlYm91bmNlRGVsYXkgPSAwO1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGVudHJ5Q29tcG9uZW50OiBhbnkgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBwZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlOiBQZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLCBwcml2YXRlIHNwaW5uZXJWaXNpYmlsaXR5U2VydmljZTogU3Bpbm5lclZpc2liaWxpdHlTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG1lcmdlKFxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLnBlbmRpbmdSZXF1ZXN0c1N0YXR1cy5waXBlKGRlYm91bmNlKHRoaXMuaGFuZGxlRGVib3VuY2UuYmluZCh0aGlzKSkpLFxuICAgICAgICAgICAgdGhpcy5zcGlubmVyVmlzaWJpbGl0eVNlcnZpY2UudmlzaWJpbGl0eU9ic2VydmFibGUsXG4gICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUodGhpcy5oYW5kbGVTcGlubmVyVmlzaWJpbGl0eSgpLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm51bGxpZnlTcGlubmVySWZDb21wb25lbnRPdXRsZXRJc0RlZmluZWQoKTtcblxuICAgICAgICBpZiAoISh0aGlzLmZpbHRlcmVkVXJsUGF0dGVybnMgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2BmaWx0ZXJlZFVybFBhdHRlcm5zYCBtdXN0IGJlIGFuIGFycmF5LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEhdGhpcy5maWx0ZXJlZFVybFBhdHRlcm5zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFVybFBhdHRlcm5zLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLmZpbHRlcmVkVXJsUGF0dGVybnMucHVzaChuZXcgUmVnRXhwKGUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbnVsbGlmeVNwaW5uZXJJZkNvbXBvbmVudE91dGxldElzRGVmaW5lZCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5lbnRyeUNvbXBvbmVudCkge1xuICAgICAgICAgICAgdGhpcy5zcGlubmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlU3Bpbm5lclZpc2liaWxpdHkoKTogKHY6IGJvb2xlYW4pID0+IHZvaWQge1xuICAgICAgICByZXR1cm4gdiA9PiB0aGlzLmlzU3Bpbm5lclZpc2libGUgPSB2O1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRGVib3VuY2UoaGFzUGVuZGluZ1JlcXVlc3RzOiBib29sZWFuKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICAgICAgaWYgKGhhc1BlbmRpbmdSZXF1ZXN0cykge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWVyKHRoaXMuZGVib3VuY2VEZWxheSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGltZXIoMCk7XG4gICAgfVxufVxuIl19